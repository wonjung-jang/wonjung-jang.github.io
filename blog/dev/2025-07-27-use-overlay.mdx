---
title: useOverlay ë¶„ì„í•´ë³´ê¸°.
description: toss slash ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ìˆëŠ” useOverlayë¥¼ ë¶„ì„í•œ ê¸°ë¡ì…ë‹ˆë‹¤.
slug: 2025-07-27-use-overlay
authors: wonjung
tags: [useOverlay]
hide_table_of_contents: false
---

import ImageWrapper from "@site/src/components/ImageWrapper";

ìš”ì¦˜ ì–´ë–»ê²Œ í•™ìŠµí•´ì•¼ í• ì§€ ê³ ë¯¼ì´ ë§ë‹¤.
ë¬´ì–¸ê°€ë¥¼ ê¹Šê²Œ ì•Œì•„ë³´ê³  ì‹¶ì€ë°, ë‚˜ì™€ ë„ˆë¬´ ë™ë–¨ì–´ì§„ ë‚´ìš©ì´ë©´ í¥ë¯¸ê°€ ì•ˆ ìƒê¸´ë‹¤.
ê·¸ë˜ì„œ ì±…ì„ í•˜ë‚˜ ì¡ê³  ë³´ê¸°ì—ëŠ” ë‚´ ìƒí™©ê³¼ ë‹¤ë¥¸ ê²Œ ë§ê³  ëª¨ë“  ë‚´ìš©ì´ ì™€ë‹¿ì§€ ì•ŠëŠ”ë‹¤.

ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ ê³ ë¯¼í•˜ë˜ ê°€ìš´ë°, ì˜¤í”ˆ ì†ŒìŠ¤ë¥¼ ëœ¯ì–´ë³´ìëŠ” ìƒê°ì„ í–ˆë‹¤.
ì–´ë–¤ ì˜¤í”ˆ ì†ŒìŠ¤ë¥¼ ë³¼ì§€ ìƒê°í•˜ë‹¤ê°€ íšŒì‚¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë„êµ¬ ìœ„ì£¼ë¡œ ë´ì•¼ê² ë‹¤ê³  ìƒê°í–ˆë‹¤.

ì²˜ìŒì—ëŠ” TanStack Queryë¥¼ ëœ¯ì–´ë³¼ê¹Œ í•˜ë‹¤ê°€ ì–‘ë„ ë§ê³  ë³µì¡í•´ì„œ ê¸ˆì„¸ í¥ë¯¸ê°€ ì‚¬ë¼ì¡Œë‹¤.
ê·¸ëŸ¬ë‹¤ tossì—ì„œ ë§Œë“  useOverlay ë³´ê²Œ ëë‹¤.
íšŒì‚¬ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆê¸°ë„ í•˜ê³  ê°„ë‹¨í•´ì„œ ëœ ë¶€ë‹´ëë‹¤.

## 1. useOverlayë€?

useOverlayë€ Overlayë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë„êµ¬ë‹¤.
Overlayë€ BottomSheetì™€ Dialogì²˜ëŸ¼ ë³„ë„ì˜ ë ˆì´ì–´ì— ë„ìš°ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤.

<ImageWrapper
  src="/blog/dev/2025-07-27-use-overlay/image.png"
  alt="useOverlay ê³µì‹ ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ì„¤ëª…"
  width="70%"
/>

ì—¬ë‹´ìœ¼ë¡œ ê³µì‹ ë¬¸ì„œë¥¼ ë³´ë‹¤ê°€ "BottomSheetê³¼"ë¡œ ë˜ì–´ ìˆëŠ” ê²Œ ì–´ìƒ‰í•´ì„œ "BottomSheetì™€"ë¡œ ë°”ê¿” ìƒì•  ì²« ì˜¤í”ˆ ì†ŒìŠ¤ PRì„ ì‘ì„±í–ˆë‹¤.
í•œ ê¸€ì ë°”ê¾¼ ê±°ë¼ ë¨¸ì“±í•˜ê¸´ í•˜ì§€ë§Œ ê·¸ë˜ë„ Merge ëœë‹¤ë©´ ê¸°ë¶„ ì¢‹ì„ ë“¯. ã…ã…

## 2. ì‚¬ìš©ë²•

```tsx
export default function App() {
  return (
    <OverlayProvider>
      <div className="App">
        <AppContent />
      </div>
    </OverlayProvider>
  );
}
```

ì‚¬ìš©ë²•ì€ ê°„ë‹¨í•˜ë‹¤.
Context APIë¥¼ í™œìš©í•˜ê¸° ë•Œë¬¸ì— Providerë¥¼ ì„ ì–¸í•´ ì¤€ë‹¤.

```tsx
function Dialog(props: { isOpen: boolean; onClose: VoidFunction }) {
  const { isOpen, onClose } = props;

  return isOpen ? (
    <div className="dialog-backdrop" onClick={onClose}>
      <div className="dialog-content" onClick={(e) => e.stopPropagation()}>
        <p>ğŸ§™â€â™‚ï¸ ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ë‹¤ì´ì–¼ë¡œê·¸ì…ë‹ˆë‹¤.</p>
        <button onClick={onClose}>ë‹«ê¸°</button>
      </div>
    </div>
  ) : null;
}

function AppContent() {
  const overlay = useOverlay();
  const onClickButton = () => {
    overlay.open(({ isOpen, close }) => (
      <Dialog isOpen={isOpen} onClose={close} />
    ));
  };

  return (
    <>
      <h1>Hello CodeSandbox</h1>
      <h2>Start editing to see some magic happen!</h2>
      <button onClick={onClickButton}>ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸°</button>
    </>
  );
}
```

ì‚¬ìš©ì²˜ì—ì„œ `useOverlay`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë²„íŠ¼ í´ë¦­ ì‹œ Dialogë¥¼ ì—´ì–´ì£¼ê³ , Dialogì—ì„œëŠ” `isOpen`ì´ `true`ì¼ ë•Œ ë Œë”ë§ë˜ë„ë¡ í•œë‹¤.

## 3. OverlayProvider

ë¨¼ì € `OverlayProvider`ê°€ ì–´ë–»ê²Œ ë˜ì–´ ìˆëŠ”ì§€ ì‚´í´ë´¤ë‹¤.

```ts
const [overlayById, setOverlayById] = useState<Map<string, ReactNode>>(
  new Map()
);
```

ë‚´ë¶€ì ìœ¼ë¡œ `overlayById`ë¼ëŠ” ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤.
`overlayById`ëŠ” `string` íƒ€ì…ì˜ `id`ë¥¼ `key`ë¡œ, `ReactNode` íƒ€ì…ì˜ `element`ë¥¼ `value`ë¡œ ì €ì¥í•œë‹¤.

```ts
const mount = useCallback((id: string, element: ReactNode) => {
  setOverlayById((overlayById) => {
    const cloned = new Map(overlayById);
    cloned.set(id, element);
    return cloned;
  });
}, []);

const unmount = useCallback((id: string) => {
  setOverlayById((overlayById) => {
    const cloned = new Map(overlayById);
    cloned.delete(id);
    return cloned;
  });
}, []);

const context = useMemo(() => ({ mount, unmount }), [mount, unmount]);
```

Provider valueë¡œ `context`ë¥¼ ë„˜ê²¨ì¤€ë‹¤.
`context`ì—ëŠ” overlayë¥¼ ê´€ë¦¬í•˜ëŠ” `mount`, `unmount` í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.

```tsx
return (
  <OverlayContext.Provider value={context}>
    {children}
    {[...overlayById.entries()].map(([id, element]) => (
      <React.Fragment key={id}>{element}</React.Fragment>
    ))}
  </OverlayContext.Provider>
);
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `children`ê³¼ `overlayById`ì— ì €ì¥ëœ ëª¨ë“  overlay ì»´í¬ë„ŒíŠ¸ë¥¼ ë°°ì¹˜í•œë‹¤.
ì‚¬ìš© ì˜ˆì‹œì—ì„œ ë´¤ë“¯ì´ overlayë“¤ì€ ê°ê° ë‚´ë¶€ì ìœ¼ë¡œ `isOpen` ìƒíƒœë¥¼ ë°›ì•„ trueì¼ ê²½ìš° UIë¥¼ ë³´ì—¬ì£¼ë„ë¡ í•´ì•¼ í•œë‹¤.

## 4. useOverlay

```ts
// í›… ì™¸ë¶€
let elementId = 1;
```

`useOverlay`ë¥¼ ì‚´í´ë³´ë©´ í›… ë°”ê¹¥ì—ì„œ `elementId` ê°’ì„ ê°–ê³  ìˆë‹¤.
ë³„ë„ì˜ `useOverlay.tsx`ë¡œ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ëª¨ë“ˆì˜ íŠ¹ì„±ìƒ ìº¡ìŠí™”ê°€ ê°€ëŠ¥í•˜ê³  ì™¸ë¶€ë¡œë¶€í„° ì ‘ê·¼ì„ ë§‰ì•„ì„œ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

```ts
interface Options {
  exitOnUnmount?: boolean;
}

export function useOverlay({ exitOnUnmount = true }: Options = {}) {
  const context = useContext(OverlayContext);

  if (context == null) {
    throw new Error("useOverlay is only available within OverlayProvider.");
  }

  const { mount, unmount } = context;
  const [id] = useState(() => String(elementId++));

  const overlayRef = useRef<OverlayControlRef | null>(null);

  useEffect(() => {
    return () => {
      if (exitOnUnmount) {
        unmount(id);
      }
    };
  }, [exitOnUnmount, id, unmount]);

  return useMemo(
    () => ({
      open: (overlayElement: CreateOverlayElement) => {
        mount(
          id,
          <OverlayController
            // NOTE: state should be reset every time we open an overlay
            key={Date.now()}
            ref={overlayRef}
            overlayElement={overlayElement}
            onExit={() => {
              unmount(id);
            }}
          />
        );
      },
      close: () => {
        overlayRef.current?.close();
      },
      exit: () => {
        unmount(id);
      },
    }),
    [id, mount, unmount]
  );
}
```

Provider ì„ ì–¸ ì—†ì´ ì‚¬ìš©í•  ë•Œ ì—ëŸ¬ë¥¼ ë˜ì ¸ì£¼ê³  `open`, `close`, `exit` ë©”ì„œë“œë¥¼ ê°–ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

### 4-1. open ë©”ì„œë“œì™€ OverlayController

```ts
open: (overlayElement: CreateOverlayElement) => {
  mount(
    id,
    <OverlayController
      // NOTE: state should be reset every time we open an overlay
      key={Date.now()}
      ref={overlayRef}
      overlayElement={overlayElement}
      onExit={() => {
        unmount(id);
      }}
    />
  );
},
```

`open`ì€ Providerë¡œë¶€í„° ë°›ì€ `mount`ë¥¼ í™œìš©í•œë‹¤.
`mount`ëŠ” ìœ„ì—ì„œ ë´¤ë“¯ì´ Providerì—ì„œ ê´€ë¦¬í•˜ëŠ” `overlayById` ìƒíƒœì— `id`ì™€ `element`ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ë‹¤.

`element`ë¥¼ ë°”ë¡œ mount í•˜ì§€ ì•Šê³  `OverlayController`ë¡œ í•œ ë²ˆ ê°ì‹¸ì„œ `mount`í•´ì¤€ë‹¤.

```tsx
export const OverlayController = forwardRef(function OverlayController(
  { overlayElement: OverlayElement, onExit }: Props,
  ref: Ref<OverlayControlRef>
) {
  const [isOpenOverlay, setIsOpenOverlay] = useState(false);

  // ...

  // overlayElementë¥¼ í˜¸ì¶œí•˜ë©´ì„œ props ì£¼ì…
  return <OverlayElement isOpen={isOpenOverlay} close={handleOverlayClose} exit={onExit} />;
}
```

`OverlayController`ëŠ” overlayì˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤.
ë‚´ë¶€ì ìœ¼ë¡œ `isOpen` ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ì„œ ì‚¬ìš©ìê°€ ì „ë‹¬í•œ `element`ì— `isOpen`, `close`, `exit`ì„ ì£¼ì…í•´ ì¤€ë‹¤.

ë˜í•œ `key`ë¥¼ `Date.now()`ë¡œ ë§¤ë²ˆ ìƒˆë¡­ê²Œ ì¤Œìœ¼ë¡œì¨ overlayë¥¼ ì—´ ë•Œë§ˆë‹¤ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•œë‹¤.

### 4-2. closeì™€ exit ë©”ì„œë“œ

```ts
close: () => {
  overlayRef.current?.close();
},
exit: () => {
  unmount(id);
},
```

`close`ëŠ” overlayë¥¼ ë‹«ëŠ” ë©”ì„œë“œë¡œ `OverlayController`ì˜ `close` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

```tsx
export const OverlayController = forwardRef(function OverlayController(
  { overlayElement: OverlayElement, onExit }: Props,
  ref: Ref<OverlayControlRef>
) {
  const [isOpenOverlay, setIsOpenOverlay] = useState(false);

  const handleOverlayClose = useCallback(() => setIsOpenOverlay(false), []);

  useImperativeHandle(
    ref,
    () => {
      return { close: handleOverlayClose };
    },
    [handleOverlayClose]
  );

  useEffect(() => {
    // NOTE: requestAnimationFrameì´ ì—†ìœ¼ë©´ ê°€ë” Open ì• ë‹ˆë©”ì´ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
    requestAnimationFrame(() => {
      setIsOpenOverlay(true);
    });
  }, []);

  // overlayElementë¥¼ í˜¸ì¶œí•˜ë©´ì„œ props ì£¼ì…
  return <OverlayElement isOpen={isOpenOverlay} close={handleOverlayClose} exit={onExit} />;
}
```

ì´ë•Œ overlayëŠ” ì–¸ë§ˆìš´íŠ¸ë˜ì§€ ì•Šê³  `isOpen`ì˜ ìƒíƒœë§Œ `false`ë¡œ ë³€ê²½í•œë‹¤.

`exit`ì€ overlayë¥¼ ì–¸ë§ˆìš´íŠ¸ ì‹œí‚¤ëŠ” ë©”ì„œë“œë‹¤.
useOverlayëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í˜¸ì¶œí•œ ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ë©´ ê°™ì´ ì–¸ë§ˆìš´íŠ¸ ëœë‹¤.
í•˜ì§€ë§Œ ì• ë‹ˆë©”ì´ì…˜ì„ ë„£ê³  ì‹¶ì€ ê²½ìš° ì–¸ë§ˆìš´íŠ¸ë˜ë©´ ì•ˆ ë˜ê¸° ë•Œë¬¸ì— ì• ë‹ˆë©”ì´ì…˜ì„ ë„£ì„ ìˆ˜ ì—†ë‹¤.

```ts
// useOverlay.ts íŒŒì¼ ë‚´ë¶€ì˜ useEffect
useEffect(() => {
  return () => {
    if (exitOnUnmount) {
      unmount(id);
    }
  };
}, [exitOnUnmount, id, unmount]);
```

`useOverlay` í˜¸ì¶œ ì‹œ `useOverlay({ exitOnUnmount: false })`ë¡œ ì„¤ì •í•˜ê²Œ ë˜ë©´ í˜¸ì¶œ ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ ë˜ë”ë¼ë„ overlayëŠ” ì–¸ë§ˆìš´íŠ¸ ë˜ì§€ ì•ŠëŠ”ë‹¤.
ë”°ë¼ì„œ ì• ë‹ˆë©”ì´ì…˜ì„ ì¤€ ë’¤ì— exit ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì–¸ë§ˆìš´íŠ¸ ì‹œì ì„ ì¡°ì •í•  ìˆ˜ ìˆë‹¤.

ì½”ë“œë¥¼ ëœ¯ì–´ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ë³µì¡í•˜ì§€ ì•Šì€ êµ¬ì¡°ì˜€ë‹¤.
ë‚˜ëŠ” í•­ìƒ Provider ë‚´ë¶€ì—ì„œ ìƒíƒœì™€ ìƒíƒœ ë³€ê²½ í•¨ìˆ˜ë¥¼ ëª¨ë‘ ì‘ì„±í–ˆë‹¤.

```ts
export function useOverlay({ exitOnUnmount = true }: Options = {}) {
  const context = useContext(OverlayContext);

  if (context == null) {
    throw new Error("useOverlay is only available within OverlayProvider.");
  }

  return context;
}
```

ê·¸ë˜ì„œ í•­ìƒ ìœ„ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œë§Œ ì‚¬ìš©í–ˆì—ˆëŠ”ë°, ì½”ë“œë¥¼ ë³´ë‹ˆ ì—­í• ì´ ëª…í™•íˆ ë¶„ë¦¬ëœ ëŠë‚Œì„ ë°›ì•˜ë‹¤.
ë‚˜ë„ ë‹¤ìŒì— Context APIë¥¼ ì“°ë©´ ì €ë ‡ê²Œ ë¶„ë¦¬í•´ì•¼ì§€.

ì˜ˆì „ì— í˜ì´ì§€ ì´ë™ ì‹œ ì• ë‹ˆë©”ì´ì…˜ì„ ì£¼ëŠ” ì‘ì—…ì„ í•´ë³¸ ê²½í—˜ì´ ìˆë‹¤.
ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ì„œëŠ” ì–¸ë§ˆìš´íŠ¸ ì‹œì ì„ ê¼­ ê´€ë¦¬í•´ ì¤˜ì•¼ í•˜ëŠ”ë°, ì´ëŸ° ë¶€ë¶„ê¹Œì§€ ìƒê°í•˜ê³  ê°„ë‹¨í•˜ê²Œ í•  ìˆ˜ ìˆë„ë¡ `close`ì™€ `exit`ì„ ë¶„ë¦¬í•œ ì„¤ê³„ê°€ ì¸ìƒ ê¹Šì—ˆë‹¤.
